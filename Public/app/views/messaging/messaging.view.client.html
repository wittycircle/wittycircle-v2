<div id="messages-body-page">
	<section id="messages-modals">
		<div id="messages-newpost-modal" class="messages-newpost" style="display: none">
			<div id="mmo" class="messages-modal-header">
				<div id="mmo" class="messages-modal-title">
					<h3 id="mmo">New message</h3>
				</div>
				<div id="mmo" class="messages-modal-cross" alt="witty-crosspicture">
					<img src="/images/cross-icon.svg">
				</div>
			</div>
			<article id="messages-modal-newMessageArea" class="animated fadeIn" style="display: none;">
				<div id="mmo" class="messages-newMessageArea-to">
					<label id="mmo">To : </label>
					<h5 id="mmo">{{newMessageArea.first_name}} {{newMessageArea.last_name}}</h5>
				</div>
				<div id="mmo" class="messages-newMessageArea-text">
					<textarea id="mmo" ng-model="newMessageArea.message" placeholder="Write a message..."></textarea>
				</div>
				<div id="mmo" class="messages-newMessageArea-send">
					<button type="submit" ng-click="createNewMessage()">Send</button>
				</div>
			</article>
			<article id="messages-modal-searchArea" style="display: block;">
				<div id="mmo" class="messages-newpost-search">
					<input id="mmoinput" type="search" placeholder="Search a username" ng-model="searchName" oninput="showUserList()">
				</div>
				<div id="mmolist" class="messages-newpost-users" style="display: none;">
					<div id="mmo" ng-if="checkId != profile.id" class="messages-newpost-user" ng-repeat="profile in profiles | filter : searchName | limitTo : 5" ng-click="searchArea(profile.id)" onclick="showNewMessageArea()" ng-click="searchArea(profile.id)">
						<div id="mmo" class="messages-newpost-puser">
							<img id="mmo" ng-src="{{ resizePic(profile.profile_picture, 60, 60, 'fill') }}" alt="witty-userpicture">
							<div id="mmo" class="messages-newpost-iuser">
								<h3 id="mmo">{{profile.first_name}} {{profile.last_name}}</h3>
								<h5 id="mmo" >{{profile.location_city}}, {{profile.location_country}}</h5>
							</div>
						</div>
					</div>

					<div class="messages-newpost-footer">
						<img src="/images/witty-logo-icon-b.svg">
					</div>
				</div>
			</article>
		</div>
		<div id="messages-confirmDelete-modal" class="messages-confirmDelete" style="display: none;">
			<div id="mcdm" class="messages-modal-header">
				<div id="mcdm" class="messages-modal-title">
					<h3 id="mcdm" >Delete conversation</h3>
				</div>
				<div class="messages-modal-cross" alt="witty-crosspicture">
					<img src="/images/cross-icon.svg">
				</div>
			</div>
			<div id="mcdm" class="messages-cd-body">
				<div id="mcdm" class="messages-cd-text">
					<h5 id="mcdm">Are you sure you want to delete this conversation ? <br />
						This action cannot be undone.
					</h5>
				</div>
				<div id="mcdm" class="messages-cd-button">
					<p>Cancel</p>
					<button type="submit" ng-click="deleteMessage()">Yes, delete it</button>
				</div>
			</div>
		</div>
	</section>

	<section id="messages-page">
		<header id="messages-header" ng-style="{'background-image': 'url({{ backPic }})'}">
			<div class="filter"></div>
			<div class="message-header-component">
				<div class="messages-header-title">
					<h1>Messages</h1>
				</div>
				<div id="mhn" class="messages-header-new" ng-click="getListUser()">
					<a id="mhn"><img src="/images/write-icon.svg">New message</a>
				</div>
			</div>
		</header>

		<section id="messages-body">
			<div class="messages-component">
				<div class="messages-contact-list">
					<div class="messages-search">
						<input type="search" placeholder="Search users or messages" ng-model="searchContact">
					</div>

					<div class="messages-contact">
						<div class="messages-list" onclick="scrollToBottom()" ng-class="{ 'actives' : tab === dialogue.id, 'unread-active' : !dialogue.read && dialogue.sender !== currentUsername }" ng-repeat="dialogue in dialogues | filter: searchContact " ng-click="showMessage(dialogue)">
							<div class="messages-list-picture">
						<img ng-src="{{ resizePic(dialogue.pic, 50, 50, 'fill') }}" alt="profile-picture">
							</div>
							<div class="messages-list-object">
								<div class="messages-list-user">
									<i ng-if="onlineUser[dialogue.to_username]" class="online-icon"></i>
									<i ng-if="!onlineUser[dialogue.to_username]" class="offline-icon"></i>
									<h4>{{dialogue.to_username}}</h4>
								</div>
								<div class="messages-list-text">
									<p>{{dialogue.last_message}}</p>
								</div>
								<span>{{dialogue.date}}</span>
							</div>
						</div>
					</div>
				</div>

				<div class="messages-conversation">
					<div class="messages-conversation-header">
						<div class="messages-conversation-left">
							<div ng-if="profile_user_picture" class="messages-header-picture">
								<img ng-src="{{ resizePic(profile_user_picture, 35, 35, 'fill') }}">
							</div>
							<div ng-if="name" class="messages-header-title">
								<h4>Conversation with {{name}}</h4>
							</div>
							<div ng-if="!name" class="messages-header-newTitle">
								<h4>New conversation</h4>
							</div>
						</div>
						<div id="mhop" ng-class="{ 'messages-header-option': name, 'messages-header-option2': !name }">
							<div id="mhop" class="messages-option-action">
								<a id="mhop" href="">Actions</a>
								<span id="mhop"><img id="mhop-i" src="/images/arrow-down-icon-b.svg"></span>
							</div>
							<div id="mobox" class="messages-option-dropdown" style="display: none;">
	<!-- 							<li>Print conversation</li>
	 -->						<li id="mcdc">Delete conversation</li>
<!-- 								<li>Block {{name}}</li>
								<li>Report {{name}}</li> -->
							</div>
						</div>
					</div>
					<div id="mcb" class="messages-conversation-body">
						<div class="messages-cb-texto" ng-repeat="message in messages track by $index">
							<div class="messages-texto-picture">
								<img ng-if="my_id === message.from_user_id" ng-src="{{ resizePic(profile_my_picture, 50, 50, 'fill') }}">
								<img ng-if="my_id !== message.from_user_id" ng-src="{{ resizePic(profile_user_picture, 50, 50, 'fill') }}">
							</div>
							<div class="messages-texto">
								<div class="messages-texto-name">
									<h4>{{message.from_username}}</h4>
									<span>{{message.creation_date | wittyDateFilter }}</span>
								</div>
								<div class="messages-texto-text">
									<p>{{message.message}}</p>
								</div>
							</div>
						</div>

						<div class="messages-cb-texto" ng-repeat="liveMessage in liveMessages track by $index">
							<div class="messages-texto-picture">
								<img ng-src="{{ resizePic(liveMessage.from_picture, 50, 50, 'fill') }}">
							</div>
							<div class="messages-texto">
								<div class="messages-texto-name">
									<h4>{{liveMessage.from_username}}</h4>
									<span>{{liveMessage.date | wittyDateFilter }}</span>
								</div>
								<div class="messages-texto-text">
									<p>{{liveMessage.message}}</p>
								</div>
							</div>
						</div>

						<div class="messages-cb-texto" ng-repeat="offMessage in offMessages track by $index">
							<div class="messages-texto-picture">
								<img ng-src="{{ resizePic(offMessage.from_picture, 50, 50, 'fill') }}">
							</div>
							<div class="messages-texto">
								<div class="messages-texto-name">
									<h4>{{offMessage.from_username}}</h4>
									<span>{{offMessage.date | wittyDateFilter }}</span>
								</div>
								<div class="messages-texto-text">
									<p>{{offMessage.message}}</p>
								</div>
							</div>
						</div>
					</div>

					<div class="messages-conversation-textarea">
						<div class="textarea-box">
							<textarea placeholder="Reply to {{name}}..." ng-keyup="keyPress($event.keyCode, username, nameuser)" ng-model="socket.message"></textarea>
						</div>
						<div id="textbtn" class="textarea-button">
							<button type="submit" ng-click="socket(username, nameuser)">Send</button>
						</div>
					</div>
				</div>
			</div>
		</section>
	</section>
	<script>
		var socket = io.connect('/');

		/*** MODAL ***/

		$('#mhn').on('mouseover', function() {
			$('#mhn').find('a').children().attr('src', '/images/write-icon-b.svg')
		});

		$('#mhn').on('mouseleave', function() {
			$('#mhn').find('a').children().attr('src', '/images/write-icon.svg')
		});

		function showUserList() {
			var x = document.getElementById('mmoinput').value;
			if (x) {
				document.getElementById('mmolist').style.display = "block";
				document.getElementById('messages-modals').style.top = "15%";
				document.getElementsByClassName('messages-newpost-search')[0].style.padding = "30px 20px 5px 20px";
			} else {
				document.getElementById('mmolist').style.display = "none";
				document.getElementById('messages-modals').style.top = "30%";
				document.getElementsByClassName('messages-newpost-search')[0].style.padding = "30px 20px 30px 20px";
			}
		}

		setTimeout(function() {
				var h = document.getElementById('mcb');
				if (h) {
					h.scrollTop = h.scrollHeight;
				}
		}, 1000);

		function scrollToBottom() {
			setTimeout(function() {
				var h = document.getElementById('mcb');
				if (h) {
					h.scrollTop = h.scrollHeight;
				}
			}, 200);
		}

		function showNewMessageArea() {
			document.getElementById('messages-modal-searchArea').style.display = "none";
			document.getElementById('messages-modal-newMessageArea').style.display = "block";
		}
	</script>
</div>

<div id="messages-body-page-mobile">
	<section id="messages-body-list-mobile">
		<div id="mslm" class="messages-search-list-mobile">
			<input type="search" placeholder="Search users or messages" ng-model="searchContact" />
		</div>

		<div id="messlist" class="messages-convers-list-mobile">
			<div class="messages-list" ng-class="{ 'actives' : tab === dialogue.id, 'unread-active' : !dialogue.read && dialogue.sender !== currentUsername }" ng-repeat="dialogue in dialogues | filter: searchContact " ng-click="showMessage(dialogue)">

				<div class="messages-list-picture">
					<img ng-src="{{ dialogue.pic }}" alt="profile-picture">
				</div>

				<div class="messages-list-object">
					<div class="messages-list-user">
						<i ng-if="onlineUser[dialogue.to_username]" class="online-icon"></i>
						<i ng-if="!onlineUser[dialogue.to_username]" class="offline-icon"></i>
						<h4>{{dialogue.to_username}}</h4>
					</div>
					<div class="messages-list-text">
						<p>{{dialogue.last_message}}</p>
					</div>
					<span>{{dialogue.date}}</span>
				</div>

			</div>
		</div>
	</section>

	<section id="messages-body-messages-mobile">
		<div id="mbom" class="messages-body-option-mobile">
			<div class="messages-backTo-mobile">
				<h3><i class="fa fa-chevron-left"></i> All conversations</h3>
			</div>
			<div class="messages-option-action-mobile">
				<a href="">Actions</a>
				<span><img src="/images/arrow-down-icon-b.svg"></span>
			</div>
		</div>

		<div class="messages-body-conversation-mobile">
			<div class="messages-body-textos">
				<div class="messages-cb-texto" ng-repeat="message in messages track by $index">
					<div class="messages-texto-picture">
						<img ng-if="my_id === message.from_user_id" ng-src="{{ resizePic(profile_my_picture, 50, 50, 'fill') }}">
						<img ng-if="my_id !== message.from_user_id" ng-src="{{ resizePic(profile_user_picture, 50, 50, 'fill') }}">
					</div>
					<div class="messages-texto">
						<div class="messages-texto-name">
							<h4>{{message.from_username}}</h4>
							<p>{{message.creation_date | wittyDateFilter }}</p>
						</div>
						<div class="messages-texto-text">
							<p>{{message.message}}</p>
						</div>
					</div>
				</div>

				<div class="messages-cb-texto" ng-repeat="liveMessage in liveMessages track by $index">
					<div class="messages-texto-picture">
						<img ng-src="{{ resizePic(liveMessage.from_picture, 50, 50, 'fill') }}">
					</div>
					<div class="messages-texto">
						<div class="messages-texto-name">
							<h4>{{liveMessage.from_username}}</h4>
							<span>{{liveMessage.date | wittyDateFilter }}</span>
						</div>
						<div class="messages-texto-text">
							<p>{{liveMessage.message}}</p>
						</div>
					</div>
				</div>

				<div class="messages-cb-texto" ng-repeat="offMessage in offMessages track by $index">
					<div class="messages-texto-picture">
						<img ng-src="{{ resizePic(offMessage.from_picture, 50, 50, 'fill') }}">
					</div>
					<div class="messages-texto">
						<div class="messages-texto-name">
							<h4>{{offMessage.from_username}}</h4>
							<span>{{offMessage.date | wittyDateFilter }}</span>
						</div>
						<div class="messages-texto-text">
							<p>{{offMessage.message}}</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="messages-conversation-textarea">
			<div class="textarea-box">
				<textarea placeholder="Reply to {{name}}..." ng-keyup="keyPress($event.keyCode, username, nameuser)" ng-model="socket.message"></textarea>
			</div>
			<div id="textbtn" class="textarea-button">
				<button type="submit" ng-click="socket(username, nameuser)">Send</button>
			</div>
		</div>
	</section>

	<script>
		$(document).ready(function() {
			var mslm 		= document.getElementById('mslm'),
				list 		= $('.messages-convers-list-mobile'),
				mbmm 		= document.getElementById('messages-body-messages-mobile'),
				mblm 		= $('#messages-body-list-mobile'),
				messlist 	= $('#messlist'),
				backToList 	= $('.messages-backTo-mobile'),
				footer 		= $('#footer-page'),
				header 		= $('#header-section');

			messlist.on('click', function() {
				classie.remove( mbmm, 'left-to-right-message');
				classie.add( mbmm, 'right-to-left-message');
				$('#messages-body-messages-mobile').show();
				$('body').css('overflow-y', 'hidden');
			});

			backToList.on('click', function() {
				classie.remove( mbmm, 'right-to-left-message');
				classie.add( mbmm, 'left-to-right-message');
				$('body').css('overflow-y', 'scroll');
			})

			$(window).scroll(function () {
				if ($(this).scrollTop() >= 85) {
					classie.add(mslm, 'body-fixed');
					list.css('padding-top', '40px');
				} else {
					classie.remove(mslm, 'body-fixed');
					list.css('padding-top', '0px');
				}
			});
		});

	</script>
</div>
