<section id="setting-page" ng-if="displayPage" class="animated fadeIn">

	<header id="setting-header" ng-style="{'background-image': 'url({{ resizePic(backPic, 1200, 410, 'fill') }})'}" style="height: 180px">
		<div class="setting-filter" style="height: 180px"></div>
		<div class="setting-header-title">
			<h1>Statistics</h1>
		</div>
	</header>

	<section class="setting-invite-modal">
		<div id="sinvitem" class="setting-invite-modal-block" style="display: none">
			<div class="setting-invite-modal-head">
				<h4>Invite friends</h4>
			</div>
			
			<div class="setting-invite-modal-body">
				<input type="email" placeholder="name@mail.com" ng-model="email" ng-keyup="addEmailToList($event.keyCode, email)"/>
				<p class="simbpress">Press enter to send an invitation</p>
				<p ng-if="errorMail">Email address not valid</p>
			</div>

			<div class="setting-invite-modal-list" ng-if="mailList.length">
				<div class="setting-invite-modal-list-email">
					<li ng-repeat="mail in mailList track by $index" >{{mail}} <img src="/images/cross-icon.svg" ng-click="removeMailFromList($index)"></li>
				</div>

				<button type="button" ng-click="sendInvitation()">{{inviteW}} <i class="fa fa-check" ng-if="sended"></i></button>
			</div>
		</div>
	</section>

	<section id="setting-body">

		<div class="setting-ranking setting-box">
			<h3>The <b>more</b> you contribute, the more people will <b>connect</b> with you.</h3>
			<section class="setting-ranking-up">
				<aside class="setting-ranking-psi">
					<div class="setting-ranking-profile">
						<div class="tooltipw" style="margin-left: -45px">Complete your profile (+1000)</div>
						<span class="srpsi-text">Full profile</span>
						<span class="srpsi-number">{{pRank.profilePercentage}}% <span class="srpsi-number-est" ng-if="pRank.profilePercentage">(+{{pRank.profilePercentage * 10}})</span></span>
					</div>

					<div class="setting-ranking-social">
						<div class="tooltipw" style="margin-left: -75px">Share the project to your network (+400)</div>
						<span class="srpsi-text">Social Sharing</span>
						<span class="srpsi-number" ng-if="pRank.socialPercentage">Yes <span class="srpsi-number-est" ng-if="pRank.socialPercentage">(+{{pRank.profilePercentage * 4}})</span></span>
						<span class="srpsi-number" ng-if="!pRank.socialPercentage">No <span class="srpsi-number-est" ng-if="pRank.socialPercentage">(+{{pRank.profilePercentage * 4}})</span></span>
					</div>

					<div class="setting-ranking-share" ng-controller="PopUpCtrl">
						<div id="fshare" class="fb-share" ng-click="facebookShare('Wittycircle | Where the world meets entrepreneurs', 'https://www.wittycircle.com', 'http://res.cloudinary.com/dqpkpmrgk/image/upload/v1476481759/Capture_d_e%CC%81cran_2016-10-14_a%CC%80_11.51.00_xdd1hm.png', 'Nobody can build great things alone. Share your ideas or projects on Wittycircle and be connected to the right people, at the right time.')">

						  <a target="_self">
						    <button><i class="fa fa-facebook" style="color: white"></i>Share on Facebook</button>
						  </a>
						</div>
						<div id="twshare" class="tw-share">
						  <a href="https://twitter.com/intent/tweet?text=Just joined @wittycircle, where the world meets&hashtags=entrepreneurs https://www.wittycircle.com">
						    <button class="tw-share"><i class="fa fa-twitter"></i> Share on Twitter</button>
						  </a>
			 			</div>
					</div>

					<div class="setting-ranking-invitation">
						<div class="sri-title">
							<div class="tooltipw" style="margin-left: -78px">Share the project to your friends (+500)</div>
							<span class="srpsi-text">Invitations</span>

							<span class="srpsi-number">{{pRank.successInvitation}} <span ng-if="pRank.successInvitation" style="font-weight: 500">(+{{pRank.successInvitation * 500}})</span></span>

						</div>

						<div class="sri-box">
							<div class="sri-box-illustre-img" ng-if="pRank.successInvitation">
								<span ng-repeat="inviteUser in pRank.inviteUsers" ><a ng-href="{{inviteUser.username}}"><img ng-src="{{ resizePic(inviteUser.profile_picture, 34, 34, 'fill') }}" alt="profile_picture"/></a></span>
							</div>
							<span id="srpsib" class="srpsi-button"> <img src="/images/mailbox-icon-b-3.svg" />Tell a friend</span>
						</div>
					</div>
				</aside>

				<aside class="setting-ranking-graph">
					<canvas id="myCanvas" width="400" height="200"></canvas>
					<h2>Ranking: <span class="srg-myrank">#{{myRank}}<span> <span ng-if="myCompareRank > 0" class="srg-compare">( {{myCompareRank}}<img src="/images/Upvote_Icon.svg" alt="rank-up-down" style="margin-left: 3px"/> )</span> <span ng-if="!myCompareRank" class="srg-compare">( - )</span></h2>
					<h5 ng-if="myRank === '-'">We rank users with more than 1000 pts. Complete your profile now and get connected to 38x more people and projects.</h5>
				</aside>

				<hr width="80%" />
			</section>

			<section class="setting-ranking-down">
				<ul class="srd-ul">
					<li>
						<div class="tooltipw" style="margin-left: -43px">Number of public projects (+200)</div>
						<div class="srpsi-text">Started projects</div> <div class="srpsi-number">{{pRank.startedProject}} <div class="srpsi-number-est" ng-if="pRank.startedProject">(+{{pRank.startedProject * 200}})</div> </div>
</li>
					<li><div class="tooltipw" style="margin-left: -40px">Number of feedback you gave (+15)</div><div class="srpsi-text">Project feedback</div> <div class="srpsi-number">{{pRank.feedbackProject}} <div class="srpsi-number-est" ng-if="pRank.feedbackProject">(+{{pRank.feedbackProject * 15}})</div> </div></li>
					<li><div class="tooltipw" style="margin-left: -46px">Number of time you helped a project (+100)</div><div class="srpsi-text">Project contributions</div> <div class="srpsi-number">0</div></li>
				</ul>

				<ul class="srd-ul">
					<li><div class="tooltipw" style="margin-left: -60px">Number of people you follow (+1)</div><div class="srpsi-text">Following</div> <div class="srpsi-number">{{pRank.followUser}} <div class="srpsi-number-est" ng-if="pRank.followUser">(+{{pRank.followUser}})</div></div></li>
					<li><div class="tooltipw" style="margin-left: -70px">Number of people following you (+2)</div><div class="srpsi-text">Followers</div> <div class="srpsi-number">{{pRank.userFollowed}} <div class="srpsi-number-est" ng-if="pRank.userFollowed">(+{{pRank.userFollowed * 2}})</div></div> </li>
					<li><div class="tooltipw" style="margin-left: -50px">Number of projects you upvoted (+15)</div><div class="srpsi-text">Upvoted projects</div> <div class="srpsi-number">{{pRank.upvotedProject}} <div class="srpsi-number-est" ng-if="pRank.upvotedProject">(+{{pRank.upvotedProject * 15}})</div></div></li>
				</ul>

				<ul class="srd-ul">
					<li><div class="tooltipw" style="margin-left: -45px">Number of messages you received (+2)</div><div class="srpsi-text">Messages received</div> <div class="srpsi-number">{{pRank.receivedMessage}} <div class="srpsi-number-est" ng-if="pRank.receivedMessage">(+{{pRank.receivedMessage * 2}})</div></div></li>
					<li><div class="tooltipw" style="margin-left: -90px">Number of people who viewed your profile (+0.5)</div><div class="srpsi-text">Profile views</div> <div class="srpsi-number">{{pRank.profileViews}} <div class="srpsi-number-est" ng-if="pRank.profileViews">(+{{pRank.profileViews * 0.5}})</div></div> </li>
					<li><div class="tooltipw" style="margin-left: -30px">Number of recurring session (+50)</div><div class="srpsi-text">Recurring sessions</div> <div class="srpsi-number">1 <div class="srpsi-number-est" ng-if="pRank.profileViews">(+50)</div></div></li>
				</ul>
			</section>
		</div>
</section>

<script>
	$(document).ready(function() {

		var context,
    		canvas,
    		sections 	= 20,
    		data = [4103, 4103, 4108, 4193, 4193, 4193, 4197, 4280, 5163, 5325, 5547, 5591, 5591, 5592, 5928, 5511, 5645, 5801, 5844, 5897];


    	function init() {

    		var	val_max 	= 5897,
    			val_min 	= 4103,
    			stepSize 	= 143,
				columnSize 	= 50,
				rowSize 	= 50,
				margin 		= 10,
				xAxis 		= [" ", "05/05", "06/05", "07/05", "08/05", "09/05", "10/05", "11/05", "12/05", "13/05", "14/05", "15/05", "16/05", "17/05", "18/05", "19/05", "20/05", "21/05", "22/05", "23/05", "24/05"]
				canvas 		= document.getElementById("myCanvas"),
				context 	= canvas.getContext("2d"),
				yScale 		= (canvas.height - columnSize - margin) / (val_max - val_min),
				xScale 		= (canvas.width - rowSize) / sections ;
				

				// Start date of ranking
				context.beginPath();
				context.fillText("05/05", 30, canvas.height);

				// Today ranking
				context.beginPath();
				context.fillText("Now", canvas.width - 30, 20);

				// Middle of ranking
				context.beginPath();
				context.setLineDash([5, 3]);
				var rest = val_max - val_min;
				var temScale = rest / 2 + val_min;
				context.fillText(temScale, margin, canvas.height / 2);
				context.moveTo(50, canvas.height / 2);
				context.lineTo(canvas.width, canvas.height / 2);
				context.strokeStyle = "#999999"
				context.stroke();

				// Ranking curve
				context.beginPath();
				context.translate(rowSize, canvas.height + val_min * yScale);
				context.scale(1, -1 * yScale);

				context.strokeStyle = "#222";
				plotData(data);

    	};

    	function plotData(dataSet) {
			context.beginPath();
			context.setLineDash([0, 0]);
			context.moveTo(0, dataSet[0] + 200);
			for (i = 1; i < sections; i++) {
				context.lineTo(i * xScale, dataSet[i] + 200);
				context.strokeStyle = "black";
				context.stroke();
			}
			context.stroke();
		}

    	init();
		
		$(this).click(function(e) {
			if (e.target.id === "srpsib") {
				$("#sinvitem").fadeIn(200);
			} else {
				if (!$("#sinvitem").is(e.target) && $("#sinvitem").has(e.target).length === 0) {
					$("#sinvitem").fadeOut(200);
				}
			}
		});

		$("#srpsib")
        .mouseover(function() { 
            $("#srpsib img").attr("src", "/images/mailbox-icon-w-5.svg");
        })
        .mouseout(function() {
            $("#srpsib img").attr("src", "/images/mailbox-icon-b-3.svg");
        });

	});
</script>
